(this["webpackJsonpspotify-fairpay"]=this["webpackJsonpspotify-fairpay"]||[]).push([[0],{42:function(t,e,n){},66:function(t,e,n){},72:function(t,e,n){"use strict";n.r(e);var r=n(1),a=n(0),c=n.n(a),s=n(32),i=n.n(s),o=(n(42),n(2)),u=n.n(o),p=n(5),f=n(34),l=n(3),d=n(10),h=n.n(d),j=n(15),b=n.n(j),m=n(36),x=function(){var t=window.crypto||window.msCrypto;return t.subtle||t.webkitSubtle},v=function(){var t=Object(p.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=x().digest({name:"SHA-256"},(new TextEncoder).encode(e)),!window.msCrypto){t.next=3;break}return t.abrupt("return",new Promise((function(t,e){n.oncomplete=function(e){t(e.target.result)},n.onerror=function(t){e(t.error)},n.onabort=function(){e("The digest operation was aborted")}})));case 3:return t.next=5,n;case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),g=function(t){var e=new Uint8Array(t);return function(t){var e={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,(function(t){return e[t]}))}(window.btoa(String.fromCharCode.apply(String,Object(m.a)(Array.from(e)))))},y=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*r));return e},O=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t?"/":"";switch(window.location.host){case"dominickendrick.github.io":return"/spotify-fairpay"+e;default:return"/"}},w="ad2aef8b86924e66941a6c4344c4bf8a",k="https://accounts.spotify.com",S="".concat(window.location.protocol,"//").concat(window.location.host).concat(O(!0),"auth-callback"),_=function(){var t=Object(p.a)(u.a.mark((function t(){var e,n,r,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=y((s=43,i=128,s=Math.ceil(s),i=Math.floor(i),Math.floor(Math.random()*(i-s+1))+s)),t.next=3,v(e);case 3:n=t.sent,r=g(n),a=y(12),sessionStorage.setItem("spotify-code-verifier",e),sessionStorage.setItem("spotify-state",a),(c=new URL(k+"/authorize")).searchParams.append("response_type","code"),c.searchParams.append("client_id",w),c.searchParams.append("redirect_uri",S),c.searchParams.append("scope","user-read-recently-played user-top-read"),c.searchParams.append("state",a),c.searchParams.append("code_challenge",r),c.searchParams.append("code_challenge_method","S256"),window.location.href=c.toString();case 17:case"end":return t.stop()}var s,i}),t)})));return function(){return t.apply(this,arguments)}}(),P=function(){var t=Object(p.a)(u.a.mark((function t(){var e,n,r,a,c,s,i,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=new URL(window.location.href).searchParams,n=e.get("code"),r=e.get("state"),a=sessionStorage.getItem("spotify-code-verifier"),c=sessionStorage.getItem("spotify-state"),s={client_id:w,grant_type:"authorization_code",code:n,redirect_uri:S,code_verifier:a},k+"/api/token",r!==c){t.next=15;break}return t.next=10,h.a.post("https://accounts.spotify.com/api/token",b.a.stringify(s),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 10:i=t.sent,o=A(i.data),sessionStorage.setItem("spotify-session-data",JSON.stringify(o)),t.next=16;break;case 15:return t.abrupt("return",Promise.reject("State did not match"));case 16:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),A=function(t){return t.expires_at=Date.now()+t.expires_in,t},C=n(12);function N(t){if(t&&t.artists){var e=t.artists.items.map((function(t,e){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:Object(r.jsx)("img",{className:"circle-image",src:t.images[2].url,alt:t.name})}),Object(r.jsx)("td",{children:t.name}),Object(r.jsx)("td",{children:t.popularity<50?"\u2714\ufe0e":""}),Object(r.jsx)("td",{children:t.popularity<50&&Object(r.jsx)("div",{children:Object(r.jsx)("a",{className:"actionLink",href:t.external_urls.website,children:"Help"})})})]},t.id)}));return Object(r.jsxs)("table",{children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{}),Object(r.jsx)("th",{children:"Artist"}),Object(r.jsx)("th",{children:"Specialist"}),Object(r.jsx)("th",{})]})}),Object(r.jsx)("tbody",{children:e})]})}return Object(r.jsx)("ul",{})}var I=n(33),L=n.n(I),E=function(t){if(t&&t.artists){var e=t.artists.items.filter((function(t){return t.popularity>50})),n=t.artists.items.length-e.length;return[e.length,n]}return[50,50]},M=function(t){return{data:t,backgroundColor:["#1db9a4","#1db954"],borderWidth:0}};function z(t){var e=Object(a.useRef)(null),n=Object(a.useState)(),c=Object(C.a)(n,2),s=c[0],i=c[1];Object(a.useEffect)((function(){if(e){var n=function(t,e){if(t&&t.current)return new L.a(t.current,{type:"doughnut",data:{datasets:[M(E(e))],labels:["Popular artist","Specialist artist"]},options:{legend:{labels:{fontColor:"white"},position:"bottom"}}})}(e,t);n&&i(n)}}),[]),Object(a.useEffect)((function(){s&&s.data&&s.data.datasets&&(s.data.datasets[0]=M(E(t)),s.update())}),[t,s]);var o=E(t),u=Object(C.a)(o,2),p=u[0],f=u[1],l=Math.floor(f/(p+f)*100);return Object(r.jsxs)("div",{children:[Object(r.jsxs)("h2",{children:["Over ",l,"% of your top 50 artists make specialist music."]}),Object(r.jsx)("canvas",{ref:e}),Object(r.jsx)("p",{children:"Most of these musicians do not recieve enough money from Spotify"}),Object(r.jsx)("p",{children:"Please help them by buying music direct or donating"})]})}var T=function(){var t=Object(p.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={client_id:w,grant_type:"authorization_code",code:e},k+"/api/token",t.next=4,h.a.post("https://accounts.spotify.com/api/token",b.a.stringify(n),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),B=function(){var t=sessionStorage.getItem("spotify-session-data");if(t)try{return JSON.parse(t)}catch(e){console.log("failed to parse storage data",e)}}(),D=function(){return console.log(Date.now()),!!(B&&B.expires_at&&B.expires_at>=Date.now())},F=function(){var t=Object(p.a)(u.a.mark((function t(){var e,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!B||!D()){t.next=3;break}return e=B.access_token,t.abrupt("return",{headers:{Authorization:"Bearer ".concat(e)}});case 3:if(!B||D()||!B.refresh_token){t.next=10;break}return t.next=6,T(B.refresh_token);case 6:return n=t.sent,r=A(n.data),sessionStorage.setItem("spotify-session-data",JSON.stringify(r)),t.abrupt("return",{headers:{Authorization:"Bearer ".concat(r.access_token)}});case 10:return t.abrupt("return",Promise.reject("Failed to refresh access token, user needs to login again"));case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),J=function(){var t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",F().then((function(t){return t})).catch((function(t){_()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),V=function(){var t=Object(p.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"AIzaSyA9TnNyVDuilrsSdYIy9zxv_2B3XLjCVG4","https://kgsearch.googleapis.com/v1/entities:search",n={query:e,limit:10,indent:!0,key:"AIzaSyA9TnNyVDuilrsSdYIy9zxv_2B3XLjCVG4",types:"Person"},t.next=5,h.a.get("https://kgsearch.googleapis.com/v1/entities:search",{params:n}).then((function(t){return console.log("knowledge graph data for ".concat(e," is: "),t.data),t.data})).catch(console.log);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),R=function(){var t=Object(p.a)(u.a.mark((function t(e,n){var r,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get("https://api.spotify.com/v1/me/top/artists?time_range=long_term&limit=20",n).then((function(t){return console.log("artists data",t.data),t.data})).catch(console.log);case 2:return r=t.sent,t.next=5,h.a.get("https://api.spotify.com/v1/me/player/recently-played?limit=50",n).then((function(t){return t.data})).catch(console.log);case 5:return a=t.sent,c=function(){var t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.items.map(function(){var t=Object(p.a)(u.a.mark((function t(e){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.listening_duration=U(e,a),t.next=3,V(e.name);case 3:return n=t.sent,r=function(){if(n&&n.itemListElement&&n.itemListElement[0]&&n.itemListElement[0].result&&n.itemListElement[0].result.url){var t=n.itemListElement.find((function(t){return void 0!==t.result.url}));return null===t||void 0===t?void 0:t.result.url}},e.external_urls.website=r(),t.abrupt("return",e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=9,c().then(function(){var t=Object(p.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Promise.all(n).then((function(t){e({items:t})}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 9:return t.abrupt("return",a);case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),U=function(t,e){var n=e.items.find((function(e){return e.track.artists.find((function(e){return e.id===t.id}))}));return(null===n||void 0===n?void 0:n.track.duration_ms)?Math.round((null===n||void 0===n?void 0:n.track.duration_ms)/1e3/60):0};function Y(){var t=Object(a.useState)({items:[]}),e=Object(C.a)(t,2),n=e[0],c=e[1],s=Object(a.useState)(),i=Object(C.a)(s,2),o=i[0],f=i[1];return Object(a.useEffect)((function(){(function(){var t=Object(p.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J();case 2:(e=t.sent)&&f(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]),Object(a.useEffect)((function(){o&&R(c,o)}),[o]),Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("h1",{children:"Your Top Artists"}),Object(r.jsxs)("div",{className:"container",children:[Object(r.jsx)("div",{className:"col",children:Object(r.jsx)(z,{artists:n})}),Object(r.jsx)("div",{className:"col artists-list",children:Object(r.jsx)(N,{artists:n})})]})]})}n(66);function G(){return Object(r.jsx)("section",{className:"App",children:Object(r.jsxs)("div",{className:"homepage",children:[Object(r.jsx)("header",{className:"App-header"}),Object(r.jsx)("h1",{children:"Are you your favourite artists being paid enough for their music on spotify?"}),Object(r.jsx)("p",{children:"More people are listening to music via Spotify, but many musicians are not being paid enough for their work."}),Object(r.jsx)("p",{children:"Check to see if your favourite artists are getting their fair share of money."}),Object(r.jsx)("button",{className:"login-button",onClick:_,children:"Login to Spotify"})]})})}function H(){return Object(a.useEffect)((function(){function t(){return(t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",P());case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(function(){return t.apply(this,arguments)})().then((function(t){window.location.href="".concat(O(!0),"top-artists")}))}),[]),Object(r.jsx)("p",{})}function X(){return Object(r.jsx)(Y,{})}var q=function(){return Object(r.jsx)(f.a,{basename:O(!1),children:Object(r.jsx)("div",{children:Object(r.jsxs)(l.c,{children:[Object(r.jsx)(l.a,{exact:!0,path:"/",children:Object(r.jsx)(G,{})}),Object(r.jsx)(l.a,{path:"/auth-callback",children:Object(r.jsx)(H,{})}),Object(r.jsx)(l.a,{path:"/top-artists",children:Object(r.jsx)(X,{})})]})})})},W=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,73)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),r(t),a(t),c(t),s(t)}))};i.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(q,{})}),document.getElementById("root")),W()}},[[72,1,2]]]);
//# sourceMappingURL=main.602ce6cd.chunk.js.map