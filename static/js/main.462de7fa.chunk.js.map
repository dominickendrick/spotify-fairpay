{"version":3,"sources":["spotify/utils.ts","spotify/api.ts","spotify/ArtistLists.tsx","spotify/ArtistChart.tsx","spotify/auth.tsx","spotify/ArtistsData.tsx","App.tsx","reportWebVitals.js","index.js"],"names":["getCryptoSubtle","crypto","window","msCrypto","subtle","webkitSubtle","sha256","s","a","digestOp","digest","name","TextEncoder","encode","Promise","res","rej","oncomplete","e","target","result","onerror","error","onabort","bufferToBase64UrlEncoded","input","ie11SafeInput","Uint8Array","b64Chars","replace","m","urlEncodeB64","btoa","String","fromCharCode","Array","from","makeid","length","characters","charactersLength","i","charAt","Math","floor","random","basename","withTrailingSlash","trailingSlash","location","host","clientId","spotifyAuthDomain","redirectUrl","protocol","loginRedirect","codeVerifier","min","max","ceil","hashed","codeChallenge","state","sessionStorage","setItem","authURL","URL","searchParams","append","href","toString","tokenExchange","params","code","get","code_verifier","getItem","request_state","postBody","client_id","grant_type","redirect_uri","axios","post","qs","stringify","headers","sessionData","sessionDataWithExpirey","setAccessTokenExpiery","data","JSON","reject","expires_at","Date","now","expires_in","ArtistList","props","artists","listItems","items","map","artist","count","className","src","images","url","alt","popularity","id","popularArtistsData","popArtists","filter","nonPopularArtists","chartData","backgroundColor","borderWidth","ArtistChart","ctx","useRef","useState","chart","setChart","useEffect","renderedChartRef","current","Chart","type","datasets","labels","options","legend","fontColor","position","renderChart","update","ref","refreshAccessToken","refresh_token","parse","console","log","getSessionData","tokenStillActive","accessTokenConfig","accessToken","access_token","Authorization","newSessionData","getAuthHeader","then","accessTokenHeader","catch","getTopArtists","setTopArtists","authHeader","topArtists","recentlyPlayed","artistsWithListeningDuration","listening_duration","getListeningDuration","recentlyPlayedList","artistTrack","find","track","artistItem","duration_ms","round","ArtistsData","authHeaders","setAuthHeader","getHeaders","Home","onClick","Auth","getToken","ArtistsPage","App","exact","path","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.462de7fa.chunk.js","sourcesContent":["export const getCrypto = () => {\n    //ie 11.x uses msCrypto\n    return (window.crypto || (window as any).msCrypto) as Crypto;\n  };\n  \n  export const getCryptoSubtle = () => {\n    const crypto = getCrypto();\n    //safari 10.x uses webkitSubtle\n    return crypto.subtle || (crypto as any).webkitSubtle;\n  };\n  \n  export const sha256 = async (s: string) => {\n    const digestOp: any = getCryptoSubtle().digest(\n      { name: \"SHA-256\" },\n      new TextEncoder().encode(s)\n    );\n  \n    // msCrypto (IE11) uses the old spec, which is not Promise based\n    // https://msdn.microsoft.com/en-us/expression/dn904640(v=vs.71)\n    // Instead of returning a promise, it returns a CryptoOperation\n    // with a result property in it.\n    // As a result, the various events need to be handled in the event that we're\n    // working in IE11 (hence the msCrypto check). These events just call resolve\n    // or reject depending on their intention.\n    if ((window as any).msCrypto) {\n      return new Promise((res, rej) => {\n        digestOp.oncomplete = (e: any) => {\n          res(e.target.result);\n        };\n  \n        digestOp.onerror = (e: ErrorEvent) => {\n          rej(e.error);\n        };\n  \n        digestOp.onabort = () => {\n          rej(\"The digest operation was aborted\");\n        };\n      });\n    }\n  \n    return await digestOp;\n  };\n  \n  const urlEncodeB64 = (input: string) => {\n    const b64Chars: { [index: string]: string } = { \"+\": \"-\", \"/\": \"_\", \"=\": \"\" };\n    return input.replace(/[+/=]/g, (m: string) => b64Chars[m]);\n  };\n  \n  // https://stackoverflow.com/questions/30106476/\n  const decodeB64 = (input: string) =>\n    decodeURIComponent(\n      atob(input)\n        .split(\"\")\n        .map((c) => {\n          return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join(\"\")\n    );\n  \n  export const urlDecodeB64 = (input: string) =>\n    decodeB64(input.replace(/_/g, \"/\").replace(/-/g, \"+\"));\n  \n  export const bufferToBase64UrlEncoded = (input: number[] | Uint8Array) => {\n    const ie11SafeInput = new Uint8Array(input);\n    return urlEncodeB64(\n      window.btoa(String.fromCharCode(...Array.from(ie11SafeInput)))\n    );\n  };\n\n  // helper function to generate a random string\nexport const makeid = (length: number) => {\n    var result = \"\";\n    var characters =\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    var charactersLength = characters.length;\n    for (var i = 0; i < length; i++) {\n      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n    }\n    return result;\n  };\n  \n  // helper function to generate a random number\n  export const getRandomInt = (min: number, max: number) => {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n  };","import axios from \"axios\";\nimport qs from \"qs\";\nimport {\n  sha256,\n  bufferToBase64UrlEncoded,\n  getRandomInt,\n  makeid,\n} from \"./utils\";\n\nexport interface SessionData {\n  access_token: string;\n  token_type: string;\n  expires_in: number;\n  refresh_token: string;\n  scope: string;\n  expires_at?: number;\n}\n\nexport const basename = (withTrailingSlash: boolean = false) => {\n  const trailingSlash = withTrailingSlash ? \"/\" : \"\";\n  switch (window.location.host) {\n    case \"dominickendrick.github.io\":\n      return \"/spotify-fairpay\" + trailingSlash;\n    default:\n      return \"/\";\n  }\n};\n\nexport const clientId = \"ad2aef8b86924e66941a6c4344c4bf8a\";\nexport const spotifyAuthDomain = \"https://accounts.spotify.com\";\nconst redirectUrl = `${window.location.protocol}//${\n  window.location.host\n}${basename(true)}auth-callback`;\nconst scopes = \"user-read-recently-played user-top-read\";\n\nexport const loginRedirect = async () => {\n  // Generate the code verifier and its base 64 encoded hash\n  const codeVerifier = makeid(getRandomInt(43, 128));\n  const hashed = await sha256(codeVerifier);\n  const codeChallenge = bufferToBase64UrlEncoded(hashed);\n  const state = makeid(12);\n\n  // Set the code verifier and state in local storage so we can check it later\n  sessionStorage.setItem(\"spotify-code-verifier\", codeVerifier);\n  sessionStorage.setItem(\"spotify-state\", state);\n\n  // construct the authentication url\n  const authURL = new URL(spotifyAuthDomain + \"/authorize\");\n\n  authURL.searchParams.append(\"response_type\", \"code\");\n  authURL.searchParams.append(\"client_id\", clientId);\n  authURL.searchParams.append(\"redirect_uri\", redirectUrl);\n  authURL.searchParams.append(\"scope\", scopes);\n  authURL.searchParams.append(\"state\", state);\n  authURL.searchParams.append(\"code_challenge\", codeChallenge);\n  authURL.searchParams.append(\"code_challenge_method\", \"S256\");\n\n  // open the spotify authentication page\n  window.location.href = authURL.toString();\n};\n\nexport const tokenExchange = async () => {\n  const params = new URL(window.location.href).searchParams;\n  const code = params.get(\"code\");\n  const state = params.get(\"state\");\n  // TODO: check state\n  const code_verifier = sessionStorage.getItem(\"spotify-code-verifier\");\n  const request_state = sessionStorage.getItem(\"spotify-state\");\n\n  const postBody = {\n    client_id: clientId,\n    grant_type: \"authorization_code\",\n    code: code,\n    redirect_uri: redirectUrl,\n    code_verifier: code_verifier,\n  };\n\n  const tokenUrl = spotifyAuthDomain + \"/api/token\";\n\n  if (state === request_state) {\n\n    //  exchange the authorisation code for the access and refresh tokens\n    const sessionData = await axios.post(tokenUrl, qs.stringify(postBody), {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n      },\n    });\n\n\n    const sessionDataWithExpirey = setAccessTokenExpiery(sessionData.data)\n    //store the acccess tokens in session storage\n    sessionStorage.setItem(\n      \"spotify-session-data\",\n      JSON.stringify(sessionDataWithExpirey)\n    );\n  } else {\n    return Promise.reject(\"State did not match\");\n  }\n};\n\nexport const setAccessTokenExpiery = (sessionData: SessionData): SessionData => {\n    sessionData.expires_at = Date.now() + sessionData.expires_in;\n    return sessionData\n}\n\nexport const getSessionData = (): SessionData | undefined => {\n  const sessionData = sessionStorage.getItem(\"spotify-session-data\");\n  if (sessionData) {\n    try {\n      return JSON.parse(sessionData);\n    } catch (e) {\n      console.log(\"failed to parse storage data\", e);\n    }\n  }\n};\n","import React from \"react\";\nimport { ArtistProps } from \"./ArtistsData\";\n\nexport function ArtistList(props?: ArtistProps) {\n  if (props && props.artists) {\n    const listItems = props.artists.items.map((artist, count) => (\n      <tr key={artist.id}>\n        <td>{count + 1}</td>\n        <td>\n          <img\n            className=\"circle-image\"\n            src={artist.images[2].url}\n            alt={artist.name}\n          ></img>\n        </td>\n        <td>{artist.name}</td>\n        <td>{artist.popularity < 50 ? \"✔︎\" : \"\"}</td>\n        <td>\n        {artist.popularity < 50  &&\n            <div>\n                <a className=\"actionLink\" href=\"https://artist.site\" >Buy CD/Vinyl</a>\n                <a className=\"actionLink\" href=\"https://artist.site\" >Buy Digital</a>\n                <a className=\"actionLink\" href=\"https://artist.site\" >Join Patreon</a>\n            </div>\n        }\n        </td>\n\n      </tr>\n    ));\n    return (\n      <table>\n        <thead>\n          <tr>\n            <th>#</th>\n            <th></th>\n            <th>Artist</th>\n            <th>Specialist musician</th>\n            <th>Take Action</th>\n          </tr>\n        </thead>\n        <tbody>{listItems}</tbody>\n      </table>\n    );\n  } else {\n    return <ul></ul>;\n  }\n}\n","import React, { useRef, useEffect, useState } from \"react\";\nimport Chart, { ChartDataSets } from \"chart.js\";\nimport { ArtistProps, Artist } from \"./ArtistsData\";\n\n// get the number of artists from the users top artists who are popular.\n  // If you have a popularity score over 50, you are popular\n  const popularArtistsData = (props: ArtistProps): Array<number> => {\n    if (props && props.artists) {\n      const popArtists = props.artists.items.filter((artist: Artist) => {\n        return artist.popularity > 50;\n      });\n      // to get nonPopularArtists you minus the popular artists from total top artists\n      const nonPopularArtists = props.artists.items.length - popArtists.length;\n      return [popArtists.length, nonPopularArtists];\n    } else {\n      return [50, 50];\n    }\n  };\n\n  const chartData = (popularArtistsData: Array<number>): ChartDataSets => {\n    return {\n      data: popularArtistsData,\n      //fill: \"none\",\n      backgroundColor: [\"#1db9a4\", \"#1db954\"],\n      borderWidth: 0,\n    };\n  };\n\n  const renderChart = (\n    ctx: React.RefObject<HTMLCanvasElement>,\n    props: ArtistProps\n  ): Chart | undefined => {\n    if (ctx && ctx.current) {\n      return new Chart(ctx.current, {\n        type: \"doughnut\",\n        data: {\n          datasets: [chartData(popularArtistsData(props))],\n          labels: [\"Popular artist\", \"Specialist artist\"],\n        },\n        options: {\n          legend: {\n            labels: {\n              // This more specific font property overrides the global property\n              fontColor: \"white\",\n            },\n            position: \"bottom\",\n          },\n        },\n      });\n    }\n  };\n\n\nexport function ArtistChart(props: ArtistProps) {\n  const ctx = useRef<HTMLCanvasElement>(null);\n  const [chart, setChart] = useState<Chart>();\n\n  useEffect(() => {\n    if (ctx) {\n      const renderedChartRef = renderChart(ctx, props);\n      if (renderedChartRef) {\n        setChart(renderedChartRef);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  },[]);\n\n  useEffect(() => {\n    if (chart && chart.data && chart.data.datasets) {\n      chart.data.datasets[0] = chartData(popularArtistsData(props));\n      chart.update();\n    }\n  }, [props, chart]);\n\n  return (\n    <div>\n        <h2>Over {popularArtistsData(props)[1] * 2}% of your top 50 artists make specialist music.</h2>\n        <canvas ref={ctx} />\n        \n        <p>Most of these musicians do not recieve enough money from Spotify</p>\n        <p>You should consider:</p>\n        <ol>\n            <li>Buying their music via Bandcamp/iTunes etc or on CD/Vinyl</li>\n            <li>Donating via Patreon or Spotify donate system</li>\n        </ol>\n        <p>You can click the buttons on the table to take action for your favourite artists!</p>       \n    </div>\n  );\n}\n","import axios from \"axios\";\nimport qs from \"qs\";\nimport {\n  clientId,\n  getSessionData,\n  loginRedirect,\n  setAccessTokenExpiery,\n  spotifyAuthDomain,\n} from \"./api\";\n\nexport interface AuthHeader {\n  headers: {\n    Authorization: string;\n  };\n}\n\nconst refreshAccessToken = async (refresh_token: string) => {\n  const postBody = {\n    client_id: clientId,\n    grant_type: \"authorization_code\",\n    code: refresh_token,\n  };\n\n  const tokenUrl = spotifyAuthDomain + \"/api/token\";\n\n  //  exchange the authorisation code for the access and refresh tokens\n  return await axios.post(tokenUrl, qs.stringify(postBody), {\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n    },\n  });\n};\n\nconst sessionData = getSessionData();\n\nconst tokenStillActive = () => {\n  return (\n    sessionData && sessionData.expires_at && sessionData.expires_at > Date.now()\n  );\n  // If there is login session data, and the current token has not expired\n};\n\nconst accessTokenConfig = async (): Promise<AuthHeader> => {\n  if (sessionData && tokenStillActive) {\n    const accessToken = sessionData.access_token;\n\n    return {\n      headers: { Authorization: `Bearer ${accessToken}` },\n    };\n  }\n\n  if (sessionData && !tokenStillActive && sessionData.refresh_token) {\n    const newSessionData = await refreshAccessToken(sessionData.refresh_token);\n    const sessionDataWithExpirey = setAccessTokenExpiery(newSessionData.data);\n    //store the acccess tokens in session storage\n    sessionStorage.setItem(\n      \"spotify-session-data\",\n      JSON.stringify(sessionDataWithExpirey)\n    );\n    return {\n      headers: {\n        Authorization: `Bearer ${sessionDataWithExpirey.access_token}`,\n      },\n    };\n  }\n\n  return Promise.reject(\n    \"Failed to refresh access token, user needs to login again\"\n  );\n};\n\nexport const getAuthHeader = async (): Promise<AuthHeader | void> => {\n  return accessTokenConfig()\n    .then((accessTokenHeader) => {\n      return accessTokenHeader;\n    })\n    .catch((error) => {\n      //if we are not able to refresh the current token,\n      //  or they are not logged in at all, redirect to spotify auth page\n      loginRedirect();\n    });\n};\n","import React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\n\nimport { ArtistList } from \"./ArtistLists\";\nimport { ArtistChart } from \"./ArtistChart\";\n\nimport { AuthHeader, getAuthHeader } from \"./auth\";\n\nexport interface ArtistProps {\n  artists: Artists;\n}\n\nexport interface ArtistDataProps {\n  authHeader: AuthHeader\n}\n\nexport interface Artists {\n  items: Array<Artist>;\n}\n\nexport interface Artist {\n  external_urls: { spotify: string };\n  followers: {\n    href: string;\n    total: number;\n  };\n  genres: Array<string>;\n  href: string;\n  id: string;\n  images: Array<ArtistImage>;\n  name: string;\n  popularity: number;\n  type: string;\n  uri: string;\n  listening_duration?: number;\n}\n\ninterface ArtistImage {\n  height: number;\n  url: string;\n  width: number;\n}\n\ninterface RecentlyPlayedList {\n  items: Array<RecentlyPlayed>;\n}\n\ninterface RecentlyPlayed {\n  context: {\n    external_urls: {\n      spotify: string;\n    };\n    href: string;\n    type: string;\n    uri: string;\n  };\n  played_at: string;\n  track: {\n    album: {\n      album_type: string;\n      artists: [\n        {\n          external_urls: { spotify: string };\n          href: string;\n          id: string;\n          name: string;\n          type: string;\n          uri: string;\n        }\n      ];\n      available_markets: Array<string>;\n      external_urls: { spotify: string };\n      href: string;\n      id: string;\n      images: Array<string>;\n      name: string;\n      release_date: string;\n      release_date_precision: string;\n      total_tracks: number;\n      type: string;\n      uri: string;\n    };\n    artists: [\n      {\n        external_urls: { spotify: string };\n        href: string;\n        id: string;\n        name: string;\n        type: string;\n        uri: string;\n      }\n    ];\n    available_markets: Array<string>;\n    disc_number: number;\n    duration_ms: number;\n    explicit: false;\n    external_ids: { isrc: string };\n    external_urls: { spotify: string };\n    href: string;\n    id: string;\n    name: string;\n    popularity: number;\n    preview_url: string;\n    track_number: number;\n    type: string;\n    uri: string;\n  };\n}\n\nexport const getTopArtists = async (setTopArtists: any, authHeader: AuthHeader) => {\n\n  // get your top artists from the api\n  const topArtists: Artists = await axios\n    .get(\n      \"https://api.spotify.com/v1/me/top/artists?time_range=long_term&limit=50\",\n      authHeader\n    )\n    .then((res) => {\n      return res.data;\n    })\n    .catch(console.log);\n\n  // get your most recently played songs\n  const recentlyPlayed: RecentlyPlayedList = await axios\n    .get(\n      \"https://api.spotify.com/v1/me/player/recently-played?limit=50\",\n      authHeader\n    )\n    .then((res) => {\n      return res.data;\n    })\n    .catch(console.log);\n\n  //get listening duration from top artists if possible\n  const artistsWithListeningDuration = topArtists.items.map(\n    (artist: Artist) => {\n      //this should be a deep copy\n      artist.listening_duration = getListeningDuration(\n        artist,\n        recentlyPlayed\n      );\n      return artist;\n    }\n  );\n\n  setTopArtists({ items: artistsWithListeningDuration });\n\n  return recentlyPlayed;\n  \n};\n\n// How much have you listened your top artists recently ?\nconst getListeningDuration = (\n  artist: Artist,\n  recentlyPlayedList: RecentlyPlayedList\n): number | undefined => {\n  //look in recently played tracks list to see if we can find the current artist\n  const artistTrack: RecentlyPlayed | undefined = recentlyPlayedList.items.find(\n    (track: RecentlyPlayed) => {\n      //look in the current tracks artists array to see if the id for this artist is in the track\n      return track.track.artists.find((artistItem) => {\n        return artistItem.id === artist.id;\n      });\n    }\n  );\n  //oops it needs to sum the durations\n  //return the duration in minutes or 0 if no duration is present\n  return artistTrack?.track.duration_ms\n    ? Math.round(artistTrack?.track.duration_ms / 1000 / 60)\n    : 0;\n};\n\n// How popular are the your top artists in terms of listen count on their most popular tracks?\n\nexport function ArtistsData() {\n  const [topArtists, setTopArtists] = useState<Artists>({ items: [] });\n  const [authHeaders, setAuthHeader] = useState<AuthHeader>()\n\n  useEffect(() => {   \n    const getHeaders = async () => {\n      const headers = await getAuthHeader()\n      if (headers) {\n        setAuthHeader(headers)\n      }\n    }\n    getHeaders()\n  },[]);\n\n  useEffect(() => {\n    if( authHeaders ){\n      getTopArtists(setTopArtists, authHeaders);\n    }\n  }, [authHeaders]);\n\n  return (\n    <div className=\"App\">\n      <h1>Your Top Artists</h1>\n      <div className=\"container\">\n        <div className=\"col\">\n          <ArtistChart artists={topArtists}></ArtistChart>\n        </div>\n        <div className=\"col\">\n          <ArtistList artists={topArtists}></ArtistList>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect } from \"react\";\nimport { BrowserRouter as Router, Switch, Route } from \"react-router-dom\";\n\nimport { loginRedirect, tokenExchange, basename } from \"./spotify/api\";\nimport {\n  ArtistsData\n} from \"./spotify/ArtistsData\";\n\nimport \"./App.css\";\n\nfunction App() {\n  return (\n    <Router basename={basename(false)}>\n      <div>\n        <Switch>\n          <Route exact path=\"/\">\n            <Home />\n          </Route>\n          <Route path=\"/auth-callback\">\n            <Auth />\n          </Route>\n          <Route path=\"/top-artists\">\n            <ArtistsPage />\n          </Route>\n        </Switch>\n      </div>\n    </Router>\n  );\n}\n\nfunction Home() {\n  return (\n    <section className=\"App\">\n      <div className=\"homepage\">\n      <header className=\"App-header\"></header>\n      <h1>\n        Are you your favourite artists being paid enough for their music on\n        spotify?\n      </h1>\n      <p>\n        More people are listening to music via Spotify, but many musicians are\n        not being paid enough for their work.\n      </p>\n      <p>\n        Check to see if your favourite artists are getting their fair share of\n        money.\n      </p>\n      <button className=\"login-button\" onClick={loginRedirect}>\n        Login to Spotify\n      </button>\n      </div>\n    </section>\n\n  );\n}\n\nfunction Auth() {\n  useEffect(() => {\n    async function getToken() {\n      return tokenExchange();\n    }\n    //once we've got the access token for spotify, we redirect the user to the top artists page\n    getToken().then((res) => {\n      window.location.href = `${basename(true)}top-artists`;\n    });\n  }, []);\n  return <p></p>;\n}\n\nfunction ArtistsPage() {\n  return(<ArtistsData></ArtistsData>)\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}