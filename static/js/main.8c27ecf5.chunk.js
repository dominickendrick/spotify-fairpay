(this["webpackJsonpspotify-fairpay"]=this["webpackJsonpspotify-fairpay"]||[]).push([[0],{42:function(t,e,r){},66:function(t,e,r){},72:function(t,e,r){"use strict";r.r(e);var n=r(0),a=r(1),s=r.n(a),c=r(32),i=r.n(c),o=(r(42),r(2)),u=r.n(o),p=r(5),f=r(34),l=r(3),d=r(10),h=r.n(d),j=r(15),b=r.n(j),m=r(36),x=function(){var t=window.crypto||window.msCrypto;return t.subtle||t.webkitSubtle},v=function(){var t=Object(p.a)(u.a.mark((function t(e){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=x().digest({name:"SHA-256"},(new TextEncoder).encode(e)),!window.msCrypto){t.next=3;break}return t.abrupt("return",new Promise((function(t,e){r.oncomplete=function(e){t(e.target.result)},r.onerror=function(t){e(t.error)},r.onabort=function(){e("The digest operation was aborted")}})));case 3:return t.next=5,r;case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),O=function(t){var e=new Uint8Array(t);return function(t){var e={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,(function(t){return e[t]}))}(window.btoa(String.fromCharCode.apply(String,Object(m.a)(Array.from(e)))))},y=function(t){for(var e="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,a=0;a<t;a++)e+=r.charAt(Math.floor(Math.random()*n));return e},g=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t?"/":"";switch(window.location.host){case"dominickendrick.github.io":return"/spotify-fairpay"+e;default:return"/"}},w="ad2aef8b86924e66941a6c4344c4bf8a",k="https://accounts.spotify.com",S="".concat(window.location.protocol,"//").concat(window.location.host).concat(g(!0),"auth-callback"),_=function(){var t=Object(p.a)(u.a.mark((function t(){var e,r,n,a,s;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=y((c=43,i=128,c=Math.ceil(c),i=Math.floor(i),Math.floor(Math.random()*(i-c+1))+c)),t.next=3,v(e);case 3:r=t.sent,n=O(r),a=y(12),sessionStorage.setItem("spotify-code-verifier",e),sessionStorage.setItem("spotify-state",a),(s=new URL(k+"/authorize")).searchParams.append("response_type","code"),s.searchParams.append("client_id",w),s.searchParams.append("redirect_uri",S),s.searchParams.append("scope","user-read-recently-played user-top-read"),s.searchParams.append("state",a),s.searchParams.append("code_challenge",n),s.searchParams.append("code_challenge_method","S256"),window.location.href=s.toString();case 17:case"end":return t.stop()}var c,i}),t)})));return function(){return t.apply(this,arguments)}}(),N=function(){var t=Object(p.a)(u.a.mark((function t(){var e,r,n,a,s,c,i,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=new URL(window.location.href).searchParams,r=e.get("code"),n=e.get("state"),a=sessionStorage.getItem("spotify-code-verifier"),s=sessionStorage.getItem("spotify-state"),c={client_id:w,grant_type:"authorization_code",code:r,redirect_uri:S,code_verifier:a},k+"/api/token",n!==s){t.next=15;break}return t.next=10,h.a.post("https://accounts.spotify.com/api/token",b.a.stringify(c),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 10:i=t.sent,o=P(i.data),sessionStorage.setItem("spotify-session-data",JSON.stringify(o)),t.next=16;break;case 15:return t.abrupt("return",Promise.reject("State did not match"));case 16:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),P=function(t){return t.expires_at=Date.now()+1e3*t.expires_in,t},A=r(12);function C(t){if(t&&t.artists){var e=t.artists.items.map((function(t,e){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{className:"artist-position",children:e+1}),Object(n.jsx)("td",{className:"artist-image",children:Object(n.jsx)("img",{className:"circle-image",src:t.images[2].url,alt:t.name})}),Object(n.jsx)("td",{className:"artist-name",children:t.name}),Object(n.jsx)("td",{className:"artist-popularity",children:t.popularity<50?"\u2714\ufe0e":""}),Object(n.jsx)("td",{children:t.popularity<50&&Object(n.jsx)("div",{children:Object(n.jsx)("a",{className:"actionLink",href:t.external_urls.website,children:"Help"})})})]},t.id)}));return Object(n.jsxs)("table",{children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:"#"}),Object(n.jsx)("th",{}),Object(n.jsx)("th",{className:"artist-name-header",children:"Artist"}),Object(n.jsx)("th",{children:"Specialist"}),Object(n.jsx)("th",{})]})}),Object(n.jsx)("tbody",{children:e})]})}return Object(n.jsx)("ul",{})}var I=r(33),L=r.n(I),E=function(t){if(t&&t.artists){var e=t.artists.items.filter((function(t){return t.popularity>50})),r=V-e.length;return[e.length,r]}return[0,0]},M=function(t){return{data:t.map((function(t){return[0,t/V*100]})),backgroundColor:["#a71db9","#1db9b9"],borderWidth:0,barPercentage:.9,xAxisID:"",yAxisID:""}};function z(t){var e=Object(a.useRef)(null),r=Object(a.useState)(),s=Object(A.a)(r,2),c=s[0],i=s[1];Object(a.useEffect)((function(){if(e){var r=function(t,e){if(t&&t.current)return new L.a(t.current,{type:"bar",data:{datasets:[M(E(e))],labels:["Pop","Specialist"]},options:{legend:{display:!1,labels:{fontColor:"white"},position:"bottom"}}})}(e,t);r&&i(r)}}),[]),Object(a.useEffect)((function(){c&&c.data&&c.data.datasets&&(c.data.datasets[0]=M(E(t)),c.update())}),[t,c]);var o=E(t),u=Object(A.a)(o,2),p=u[0],f=u[1],l=Math.floor(f/(p+f)*100);return Object(n.jsxs)("div",{children:[Object(n.jsxs)("h2",{children:["Over ",l,"% of your top ",V," artists make specialist music."]}),Object(n.jsx)("canvas",{ref:e}),Object(n.jsx)("p",{children:"Most of these musicians do not recieve enough money from Spotify"}),Object(n.jsx)("p",{children:"Please help them by buying music direct or donating"})]})}var T=function(){var t=Object(p.a)(u.a.mark((function t(e){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={client_id:w,grant_type:"authorization_code",code:e},k+"/api/token",t.next=4,h.a.post("https://accounts.spotify.com/api/token",b.a.stringify(r),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),D=function(){var t=sessionStorage.getItem("spotify-session-data");if(t)try{return JSON.parse(t)}catch(e){console.log("failed to parse storage data",e)}}(),B=function(){return!!(D&&D.expires_at&&D.expires_at>=Date.now())},F=function(){var t=Object(p.a)(u.a.mark((function t(){var e,r,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!D||!B()){t.next=3;break}return e=D.access_token,t.abrupt("return",Promise.resolve({headers:{Authorization:"Bearer ".concat(e)}}));case 3:if(!D||B()||!D.refresh_token){t.next=11;break}return console.log("session not active but have refresh token",B()),t.next=7,T(D.refresh_token);case 7:return r=t.sent,n=P(r.data),sessionStorage.setItem("spotify-session-data",JSON.stringify(n)),t.abrupt("return",Promise.resolve({headers:{Authorization:"Bearer ".concat(n.access_token)}}));case 11:return t.abrupt("return",Promise.reject("Failed to refresh access token, user needs to login again"));case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),J=function(){var t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",F().then((function(t){return t})).catch((function(t){_()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),V=20,R=function(){var t=Object(p.a)(u.a.mark((function t(e){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"AIzaSyA9TnNyVDuilrsSdYIy9zxv_2B3XLjCVG4","https://kgsearch.googleapis.com/v1/entities:search",r={query:e,limit:10,indent:!0,key:"AIzaSyA9TnNyVDuilrsSdYIy9zxv_2B3XLjCVG4",types:"Person"},t.next=5,h.a.get("https://kgsearch.googleapis.com/v1/entities:search",{params:r}).then((function(t){return console.log("knowledge graph data for ".concat(e," is: "),t.data),t.data})).catch(console.log);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),U=function(){var t=Object(p.a)(u.a.mark((function t(e,r){var n,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get("https://api.spotify.com/v1/me/top/artists?time_range=long_term&limit=".concat(V),r).then((function(t){return console.log("artists data",t.data),t.data})).catch(console.log);case 2:return n=t.sent,a=function(){var t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.items.map(function(){var t=Object(p.a)(u.a.mark((function t(e){var r,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,R(e.name);case 2:return r=t.sent,n=function(){if(r&&r.itemListElement&&r.itemListElement[0]&&r.itemListElement[0].result&&r.itemListElement[0].result.url){var t=r.itemListElement.find((function(t){return void 0!==t.result.url}));return null===t||void 0===t?void 0:t.result.url}},e.external_urls.website=n(),t.abrupt("return",e);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=6,a().then(function(){var t=Object(p.a)(u.a.mark((function t(r){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Promise.all(r).then((function(t){e({items:t})}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 6:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}();function Y(){var t=Object(a.useState)({items:[]}),e=Object(A.a)(t,2),r=e[0],s=e[1],c=Object(a.useState)(),i=Object(A.a)(c,2),o=i[0],f=i[1];return Object(a.useEffect)((function(){(function(){var t=Object(p.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J();case 2:(e=t.sent)&&f(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]),Object(a.useEffect)((function(){o&&U(s,o)}),[o]),Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)("h1",{children:"Your Top Artists"}),Object(n.jsxs)("div",{className:"container",children:[Object(n.jsx)("div",{className:"col",children:Object(n.jsx)(z,{artists:r})}),Object(n.jsx)("div",{className:"col artists-list",children:Object(n.jsx)(C,{artists:r})})]})]})}r(66);function G(){return Object(n.jsx)("section",{className:"App",children:Object(n.jsxs)("div",{className:"homepage",children:[Object(n.jsx)("header",{className:"App-header"}),Object(n.jsx)("h1",{children:"Are you your favourite artists being paid enough for their music on spotify?"}),Object(n.jsx)("p",{children:"More people are listening to music via Spotify, but many musicians are not being paid enough for their work."}),Object(n.jsx)("p",{children:"Check to see if your favourite artists are getting their fair share of money."}),Object(n.jsx)("button",{className:"login-button",onClick:_,children:"Login to Spotify"})]})})}function H(){return Object(a.useEffect)((function(){function t(){return(t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",N());case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(function(){return t.apply(this,arguments)})().then((function(t){window.location.href="".concat(g(!0),"top-artists")}))}),[]),Object(n.jsx)("p",{})}function X(){return Object(n.jsx)(Y,{})}var q=function(){return Object(n.jsx)(f.a,{basename:g(!1),children:Object(n.jsx)("div",{children:Object(n.jsxs)(l.c,{children:[Object(n.jsx)(l.a,{exact:!0,path:"/",children:Object(n.jsx)(G,{})}),Object(n.jsx)(l.a,{path:"/auth-callback",children:Object(n.jsx)(H,{})}),Object(n.jsx)(l.a,{path:"/top-artists",children:Object(n.jsx)(X,{})})]})})})},W=function(t){t&&t instanceof Function&&r.e(3).then(r.bind(null,73)).then((function(e){var r=e.getCLS,n=e.getFID,a=e.getFCP,s=e.getLCP,c=e.getTTFB;r(t),n(t),a(t),s(t),c(t)}))};i.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(q,{})}),document.getElementById("root")),W()}},[[72,1,2]]]);
//# sourceMappingURL=main.8c27ecf5.chunk.js.map