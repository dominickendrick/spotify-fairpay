(this["webpackJsonpspotify-fairpay"]=this["webpackJsonpspotify-fairpay"]||[]).push([[0],{42:function(t,e,n){},66:function(t,e,n){},72:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n(1),c=n.n(a),i=n(32),s=n.n(i),o=(n(42),n(2)),u=n.n(o),p=n(5),d=n(34),f=n(3),h=n(10),l=n.n(h),j=n(15),b=n.n(j),m=n(36),x=function(){var t=window.crypto||window.msCrypto;return t.subtle||t.webkitSubtle},O=function(){var t=Object(p.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=x().digest({name:"SHA-256"},(new TextEncoder).encode(e)),!window.msCrypto){t.next=3;break}return t.abrupt("return",new Promise((function(t,e){n.oncomplete=function(e){t(e.target.result)},n.onerror=function(t){e(t.error)},n.onabort=function(){e("The digest operation was aborted")}})));case 3:return t.next=5,n;case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),y=function(t){var e=new Uint8Array(t);return function(t){var e={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,(function(t){return e[t]}))}(window.btoa(String.fromCharCode.apply(String,Object(m.a)(Array.from(e)))))},g=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*r));return e},v=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t?"/":"";switch(window.location.host){case"dominickendrick.github.io":return"/spotify-fairpay"+e;default:return"/"}},w="ad2aef8b86924e66941a6c4344c4bf8a",k="https://accounts.spotify.com",S="".concat(window.location.protocol,"//").concat(window.location.host).concat(v(!0),"auth-callback"),_=function(){var t=Object(p.a)(u.a.mark((function t(){var e,n,r,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=g((i=43,s=128,i=Math.ceil(i),s=Math.floor(s),Math.floor(Math.random()*(s-i+1))+i)),t.next=3,O(e);case 3:n=t.sent,r=y(n),a=g(12),sessionStorage.setItem("spotify-code-verifier",e),sessionStorage.setItem("spotify-state",a),(c=new URL(k+"/authorize")).searchParams.append("response_type","code"),c.searchParams.append("client_id",w),c.searchParams.append("redirect_uri",S),c.searchParams.append("scope","user-read-recently-played user-top-read"),c.searchParams.append("state",a),c.searchParams.append("code_challenge",r),c.searchParams.append("code_challenge_method","S256"),window.location.href=c.toString();case 17:case"end":return t.stop()}var i,s}),t)})));return function(){return t.apply(this,arguments)}}(),P=function(){var t=Object(p.a)(u.a.mark((function t(){var e,n,r,a,c,i,s,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=new URL(window.location.href).searchParams,n=e.get("code"),r=e.get("state"),a=sessionStorage.getItem("spotify-code-verifier"),c=sessionStorage.getItem("spotify-state"),i={client_id:w,grant_type:"authorization_code",code:n,redirect_uri:S,code_verifier:a},k+"/api/token",r!==c){t.next=15;break}return t.next=10,l.a.post("https://accounts.spotify.com/api/token",b.a.stringify(i),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 10:s=t.sent,o=C(s.data),sessionStorage.setItem("spotify-session-data",JSON.stringify(o)),t.next=16;break;case 15:return t.abrupt("return",Promise.reject("State did not match"));case 16:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),C=function(t){return t.expires_at=Date.now()+t.expires_in,t},N=n(14);function A(t){if(t&&t.artists){var e=t.artists.items.map((function(t,e){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:e+1}),Object(r.jsx)("td",{children:Object(r.jsx)("img",{className:"circle-image",src:t.images[2].url,alt:t.name})}),Object(r.jsx)("td",{children:t.name}),Object(r.jsx)("td",{children:t.popularity<50?"\u2714\ufe0e":""}),Object(r.jsx)("td",{children:t.popularity<50&&Object(r.jsxs)("div",{children:[Object(r.jsx)("a",{className:"actionLink",href:"https://artist.site",children:"Buy CD/Vinyl"}),Object(r.jsx)("a",{className:"actionLink",href:"https://artist.site",children:"Buy Digital"}),Object(r.jsx)("a",{className:"actionLink",href:"https://artist.site",children:"Join Patreon"})]})})]},t.id)}));return Object(r.jsxs)("table",{children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"#"}),Object(r.jsx)("th",{}),Object(r.jsx)("th",{children:"Artist"}),Object(r.jsx)("th",{children:"Specialist musician"}),Object(r.jsx)("th",{children:"Take Action"})]})}),Object(r.jsx)("tbody",{children:e})]})}return Object(r.jsx)("ul",{})}var M=n(33),I=n.n(M),T=function(t){if(t&&t.artists){var e=t.artists.items.filter((function(t){return t.popularity>50})),n=t.artists.items.length-e.length;return[e.length,n]}return[50,50]},B=function(t){return{data:t,backgroundColor:["#1db9a4","#1db954"],borderWidth:0}};function L(t){var e=Object(a.useRef)(null),n=Object(a.useState)(),c=Object(N.a)(n,2),i=c[0],s=c[1];return Object(a.useEffect)((function(){if(e){var n=function(t,e){if(t&&t.current)return new I.a(t.current,{type:"doughnut",data:{datasets:[B(T(e))],labels:["Popular artist","Specialist artist"]},options:{legend:{labels:{fontColor:"white"},position:"bottom"}}})}(e,t);n&&s(n)}}),[]),Object(a.useEffect)((function(){i&&i.data&&i.data.datasets&&(i.data.datasets[0]=B(T(t)),i.update())}),[t,i]),Object(r.jsxs)("div",{children:[Object(r.jsxs)("h2",{children:["Over ",2*T(t)[1],"% of your top 50 artists make specialist music."]}),Object(r.jsx)("canvas",{ref:e}),Object(r.jsx)("p",{children:"Most of these musicians do not recieve enough money from Spotify"}),Object(r.jsx)("p",{children:"You should consider:"}),Object(r.jsxs)("ol",{children:[Object(r.jsx)("li",{children:"Buying their music via Bandcamp/iTunes etc or on CD/Vinyl"}),Object(r.jsx)("li",{children:"Donating via Patreon or Spotify donate system"})]}),Object(r.jsx)("p",{children:"You can click the buttons on the table to take action for your favourite artists!"})]})}var D=function(){var t=Object(p.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={client_id:w,grant_type:"authorization_code",code:e},k+"/api/token",t.next=4,l.a.post("https://accounts.spotify.com/api/token",b.a.stringify(n),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),E=function(){var t=sessionStorage.getItem("spotify-session-data");if(t)try{return JSON.parse(t)}catch(e){console.log("failed to parse storage data",e)}}(),J=function(){return E&&E.expires_at&&E.expires_at>Date.now()},z=function(){var t=Object(p.a)(u.a.mark((function t(){var e,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!E||!J){t.next=3;break}return e=E.access_token,t.abrupt("return",{headers:{Authorization:"Bearer ".concat(e)}});case 3:if(!E||J||!E.refresh_token){t.next=10;break}return t.next=6,D(E.refresh_token);case 6:return n=t.sent,r=C(n.data),sessionStorage.setItem("spotify-session-data",JSON.stringify(r)),t.abrupt("return",{headers:{Authorization:"Bearer ".concat(r.access_token)}});case 10:return t.abrupt("return",Promise.reject("Failed to refresh access token, user needs to login again"));case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),F=function(){var t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",z().then((function(t){return t})).catch((function(t){_()})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=function(){var t=Object(p.a)(u.a.mark((function t(e,n){var r,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.get("https://api.spotify.com/v1/me/top/artists?time_range=long_term&limit=50",n).then((function(t){return t.data})).catch(console.log);case 2:return r=t.sent,t.next=5,l.a.get("https://api.spotify.com/v1/me/player/recently-played?limit=50",n).then((function(t){return t.data})).catch(console.log);case 5:return a=t.sent,c=r.items.map((function(t){return t.listening_duration=U(t,a),t})),e({items:c}),t.abrupt("return",a);case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),U=function(t,e){var n=e.items.find((function(e){return e.track.artists.find((function(e){return e.id===t.id}))}));return(null===n||void 0===n?void 0:n.track.duration_ms)?Math.round((null===n||void 0===n?void 0:n.track.duration_ms)/1e3/60):0};function Y(){var t=Object(a.useState)({items:[]}),e=Object(N.a)(t,2),n=e[0],c=e[1],i=Object(a.useState)(),s=Object(N.a)(i,2),o=s[0],d=s[1];return Object(a.useEffect)((function(){(function(){var t=Object(p.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F();case 2:(e=t.sent)&&d(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]),Object(a.useEffect)((function(){o&&R(c,o)}),[o]),Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("h1",{children:"Your Top Artists"}),Object(r.jsxs)("div",{className:"container",children:[Object(r.jsx)("div",{className:"col",children:Object(r.jsx)(L,{artists:n})}),Object(r.jsx)("div",{className:"col",children:Object(r.jsx)(A,{artists:n})})]})]})}n(66);function V(){return Object(r.jsx)("section",{className:"App",children:Object(r.jsxs)("div",{className:"homepage",children:[Object(r.jsx)("header",{className:"App-header"}),Object(r.jsx)("h1",{children:"Are you your favourite artists being paid enough for their music on spotify?"}),Object(r.jsx)("p",{children:"More people are listening to music via Spotify, but many musicians are not being paid enough for their work."}),Object(r.jsx)("p",{children:"Check to see if your favourite artists are getting their fair share of money."}),Object(r.jsx)("button",{className:"login-button",onClick:_,children:"Login to Spotify"})]})})}function H(){return Object(a.useEffect)((function(){function t(){return(t=Object(p.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",P());case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(function(){return t.apply(this,arguments)})().then((function(t){window.location.href="".concat(v(!0),"top-artists")}))}),[]),Object(r.jsx)("p",{})}function W(){return Object(r.jsx)(Y,{})}var q=function(){return Object(r.jsx)(d.a,{basename:v(!1),children:Object(r.jsx)("div",{children:Object(r.jsxs)(f.c,{children:[Object(r.jsx)(f.a,{exact:!0,path:"/",children:Object(r.jsx)(V,{})}),Object(r.jsx)(f.a,{path:"/auth-callback",children:Object(r.jsx)(H,{})}),Object(r.jsx)(f.a,{path:"/top-artists",children:Object(r.jsx)(W,{})})]})})})},G=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,73)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),r(t),a(t),c(t),i(t)}))};s.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(q,{})}),document.getElementById("root")),G()}},[[72,1,2]]]);
//# sourceMappingURL=main.462de7fa.chunk.js.map